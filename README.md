# message-queue-examples

## MQ中的问题

### 消息丢失场景及解决方案
防止消息丢失，可启用ack模式（禁用auto-ack）。
消息丢失可以简单的分为两种：客户端丢失和服务端丢失。

服务端丢失：
  1. mq服务器重启
  2. mq服务器宕机
因为消息是保存在内存中，所以需要引入持久化机制。

客户端丢失：
  1. 客户端重启或宕机时，会丢失 执行中未完成 和 已接收未执行 的消息。
改为ack模式（禁用auto-ack）。

rabbit: [RabbitMQ防止消息丢失](http://www.cnblogs.com/Leo_wl/p/6581989.html)
rocket: 
kafka: 

### ack机制引起的服务端内存泄漏、消费者重复消费、消息队列阻塞
ack模式下服务端只有在收到消费者确认后，才会从内存中删除消息，如果消费者忘了确认（或其它异常情况，导致服务端未接收到确认信息）。
那么，此消息一直处于服务端的消息队列的队首位置，所以会导致`消息队列阻塞`，并且会一直发送此消息给消费者消费（`消费者重复消费`），直到此条消息被移除。
因为消息队列阻塞，那么服务端会堆积越来越多的消息，导致`服务端内存泄漏`。

### 消息重复发送，如何避免重复消费，及如何防止old-data覆盖new-data